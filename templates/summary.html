<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Summary</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="dark-theme">

    <div class="container mt-5">
        <h1 class="text-white mb-4">Today's Summary</h1>

        <!-- Total Calories -->
        <div class="alert alert-dark-custom text-white mb-4">
            <strong>Total Calories:</strong> {{ total }} kcal  
            <br>
            <strong>Total Items:</strong> {{ count }}
        </div>

        <!-- MEALS TABLE -->
        <div class="card-dark p-3 mb-4">
            <h4 class="text-white mb-3">Meals Logged Today</h4>

            {% if meals|length == 0 %}
                <p class="text-muted">No meals logged today.</p>
            {% else %}
            <table class="table table-dark table-striped">
                <thead>
                    <tr>
                        <th>Food</th>
                        <th>Calories</th>
                        <th>Protein</th>
                        <th>Carbs</th>
                        <th>Fat</th>
                    </tr>
                </thead>
                <tbody>
                    {% for m in meals %}
                    <tr>
                        <td>{{ m.food_name }}</td>
                        <td>{{ m.calories|round(1) }}</td>
                        <td>{{ m.protein|round(1) }}</td>
                        <td>{{ m.carbs|round(1) }}</td>
                        <td>{{ m.fat|round(1) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>

        <!-- DAILY CHART -->
        <div class="card-dark p-4">
            <h4 class="text-white text-center mb-3">Daily Calorie Breakdown</h4>
            <canvas id="dailyChart"></canvas>
        </div>

    </div>

<script>
    // === FIXED: Clean aggregated data directly from backend ===
    const labels = [
        {% for m in meals %}
            "{{ m.food_name }}",
        {% endfor %}
    ];

    const calories = [
        {% for m in meals %}
            {{ m.calories }},
        {% endfor %}
    ];

    const ctx = document.getElementById('dailyChart').getContext('2d');

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: "Calories",
                data: calories,
                borderWidth: 2
            }]
        },
        options: {
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: "white" }
                },
                x: {
                    ticks: { color: "white" }
                }
            }
        }
    });
</script>

</body>
</html>
